"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2298],{93908:function(e,t,a){a.d(t,{n:function(){return c}});var l=a(15469),r=a(65093),o=a(9525),s=a(78900),n=a(64626),i=a(12505),d=a(41639);let c=async(e,t,a)=>{var c,u;let v={},m=(null===(u=(0,d.F5)(t))||void 0===u?void 0:null===(c=u.addresses)||void 0===c?void 0:c.aquaVault)||l.N;a.forEach(e=>{v[e.address.toLowerCase()]={lpDecimals:e.lpDecimals,totalCash:0,totalRetailBorrow:0,totalMMBorrow:0,totalReserves:0,totalSupply:0,retailSupplyApy:0,creditSupplyApy:0,interestRateModelAddress:"",utilizationRate:0,priceUsd:e.priceUsd,baseRatePerTimestamp:0,jumpMultiplierPerTimestamp:0,kink:0,multiplierPerTimestamp:0,liquidationPenalty:0,reserveFactor:0}});let p=await e.tryBlockAndAggregate.staticCall(!1,[...a.map(e=>({target:e.lpAddress,callData:new r.vU(i.Wo).encodeFunctionData("decimals",[])})),...a.map(e=>({target:e.lpAddress,callData:new r.vU(i.w8).encodeFunctionData("getCash",[])})),...a.map(e=>({target:e.lpAddress,callData:new r.vU(i.w8).encodeFunctionData("totalBorrows",[])})),...a.map(e=>({target:e.lpAddress,callData:new r.vU(i.w8).encodeFunctionData("netSwapBorrow",[])})),...a.map(e=>({target:e.lpAddress,callData:new r.vU(i.w8).encodeFunctionData("totalReserves",[])})),...a.map(e=>({target:e.lpAddress,callData:new r.vU(i.w8).encodeFunctionData("interestRateModel",[])})),...a.map(e=>({target:m,callData:new r.vU(i.G1).encodeFunctionData("liquidationIncentiveMantissa",[])})),...a.map(e=>({target:e.lpAddress,callData:new r.vU(i.w8).encodeFunctionData("reserveFactorMantissa",[])})),...a.map(e=>({target:e.lpAddress,callData:new r.vU(i.Wo).encodeFunctionData("totalSupply",[])}))]),w=(0,d.p$)(p)[2],g=0;w.slice(g,g+a.length).forEach((e,t)=>{var l;let r=a[t],o=new n.Z(null==w?void 0:null===(l=w[g+t])||void 0===l?void 0:l[1]).toNumber();v[r.address.toLowerCase()].lpDecimals=o||18}),g=a.length,w.slice(g,g+a.length).forEach((e,t)=>{var l;let r=a[t],o=new n.Z(null==w?void 0:null===(l=w[g+t])||void 0===l?void 0:l[1]).toString(10),s=new n.Z(o).div(10**v[r.address.toLowerCase()].lpDecimals).toNumber();v[r.address.toLowerCase()].totalCash=s}),g=2*a.length,w.slice(g,g+a.length).forEach((e,t)=>{var l;let r=a[t],o=new n.Z(null==w?void 0:null===(l=w[g+t])||void 0===l?void 0:l[1]).toString(10),s=new n.Z(o).div(10**v[r.address.toLowerCase()].lpDecimals).toNumber();v[r.address.toLowerCase()].totalRetailBorrow=s}),g=3*a.length,w.slice(g,g+a.length).forEach((e,t)=>{var l;let r=a[t],s=new o.R,i=null==w?void 0:null===(l=w[g+t])||void 0===l?void 0:l[1],d="0";try{d=s.decode(["int"],i)[0]}catch(e){}let c=new n.Z(d).div(10**v[r.address.toLowerCase()].lpDecimals).toNumber();v[r.address.toLowerCase()].totalMMBorrow=c<0?0:c}),g=4*a.length,w.slice(g,g+a.length).forEach((e,t)=>{var l;let r=a[t],o=new n.Z(null==w?void 0:null===(l=w[g+t])||void 0===l?void 0:l[1]).toString(10),s=new n.Z(o).div(10**v[r.address.toLowerCase()].lpDecimals).toNumber();v[r.address.toLowerCase()].totalReserves=s}),g=5*a.length,w.slice(g,g+a.length).forEach((e,t)=>{var r,o;let n=a[t],i="0x"+(null==w?void 0:null===(o=w[g+t])||void 0===o?void 0:null===(r=o[1])||void 0===r?void 0:r.slice(-40));v[n.address.toLowerCase()].interestRateModelAddress=(0,s.UJ)(i)?i:l.N}),g=6*a.length,w.slice(g,g+a.length).forEach((e,t)=>{var l;let r=a[t],o=new n.Z(null==w?void 0:null===(l=w[g+t])||void 0===l?void 0:l[1]).toString(10)||"0",s=new n.Z(o).div(1e18).toNumber();v[r.address.toLowerCase()].liquidationPenalty=100*s}),g=7*a.length,w.slice(g,g+a.length).forEach((e,t)=>{var l;let r=a[t],o=new n.Z(null==w?void 0:null===(l=w[g+t])||void 0===l?void 0:l[1]).toString(10)||"0",s=new n.Z(o).div(1e18).toNumber();v[r.address.toLowerCase()].reserveFactor=100*s}),g=8*a.length,w.slice(g,g+a.length).forEach((e,t)=>{var l;let r=a[t],o=new n.Z(null==w?void 0:null===(l=w[g+t])||void 0===l?void 0:l[1]).toString(10)||"0",s=new n.Z(o).div(10**r.lpDecimals).toNumber();v[r.address.toLowerCase()].totalSupply=s});let h=await e.tryBlockAndAggregate.staticCall(!1,[...a.map(e=>({target:v[e.address.toLowerCase()].interestRateModelAddress,callData:new r.vU(i.kp).encodeFunctionData("utilizationRate",[new n.Z(v[e.address.toLowerCase()].totalCash||0).times(10**v[e.address.toLowerCase()].lpDecimals).decimalPlaces(0,1).toString(10),new n.Z(v[e.address.toLowerCase()].totalMMBorrow+v[e.address.toLowerCase()].totalRetailBorrow||0).times(10**v[e.address.toLowerCase()].lpDecimals).decimalPlaces(0,1).toString(10),new n.Z(v[e.address.toLowerCase()].totalReserves||0).times(10**v[e.address.toLowerCase()].lpDecimals).decimalPlaces(0,1).toString(10)])})),...a.map(e=>({target:v[e.address.toLowerCase()].interestRateModelAddress,callData:new r.vU(i.kp).encodeFunctionData("baseRatePerTimestamp",[])})),...a.map(e=>({target:v[e.address.toLowerCase()].interestRateModelAddress,callData:new r.vU(i.kp).encodeFunctionData("jumpMultiplierPerTimestamp",[])})),...a.map(e=>({target:v[e.address.toLowerCase()].interestRateModelAddress,callData:new r.vU(i.kp).encodeFunctionData("kink",[])})),...a.map(e=>({target:v[e.address.toLowerCase()].interestRateModelAddress,callData:new r.vU(i.kp).encodeFunctionData("multiplierPerTimestamp",[])})),...a.map(e=>({target:v[e.address.toLowerCase()].interestRateModelAddress,callData:new r.vU(i.kp).encodeFunctionData("getSupplyRate",[new n.Z(v[e.address.toLowerCase()].totalCash||0).times(10**v[e.address.toLowerCase()].lpDecimals).decimalPlaces(0,1).toString(10),new n.Z(v[e.address.toLowerCase()].totalRetailBorrow||0).times(10**v[e.address.toLowerCase()].lpDecimals).decimalPlaces(0,1).toString(10),new n.Z(v[e.address.toLowerCase()].totalReserves||0).times(10**v[e.address.toLowerCase()].lpDecimals).decimalPlaces(0,1).toString(10),new n.Z(v[e.address.toLowerCase()].reserveFactor||0).times(10**v[e.address.toLowerCase()].lpDecimals).decimalPlaces(0,1).toString(10)])})),...a.map(e=>({target:v[e.address.toLowerCase()].interestRateModelAddress,callData:new r.vU(i.kp).encodeFunctionData("getSupplyRate",[new n.Z(v[e.address.toLowerCase()].totalCash||0).times(10**v[e.address.toLowerCase()].lpDecimals).decimalPlaces(0,1).toString(10),new n.Z(v[e.address.toLowerCase()].totalMMBorrow||0).times(10**v[e.address.toLowerCase()].lpDecimals).decimalPlaces(0,1).toString(10),new n.Z(v[e.address.toLowerCase()].totalReserves||0).times(10**v[e.address.toLowerCase()].lpDecimals).decimalPlaces(0,1).toString(10),new n.Z(v[e.address.toLowerCase()].reserveFactor||0).times(10**v[e.address.toLowerCase()].lpDecimals).decimalPlaces(0,1).toString(10)])}))]),U=(0,d.p$)(h)[2];return g=0,U.slice(g,g+a.length).forEach((e,t)=>{var l;let r=a[t],o=new n.Z(null==U?void 0:null===(l=U[g+t])||void 0===l?void 0:l[1]).toString(10),s=new n.Z(o).div(1e18).toNumber();v[r.address.toLowerCase()].utilizationRate=Math.min(100*s,100)}),g=a.length,U.slice(g,g+a.length).forEach((e,t)=>{var l;let r=a[t],o=new n.Z(null==U?void 0:null===(l=U[g+t])||void 0===l?void 0:l[1]).toString(10),s=new n.Z(o).div(1e18).toNumber();v[r.address.toLowerCase()].baseRatePerTimestamp=s}),g=2*a.length,U.slice(g,g+a.length).forEach((e,t)=>{var l;let r=a[t],o=new n.Z(null==U?void 0:null===(l=U[g+t])||void 0===l?void 0:l[1]).toString(10),s=new n.Z(o).div(1e18).toNumber();v[r.address.toLowerCase()].jumpMultiplierPerTimestamp=s}),g=3*a.length,U.slice(g,g+a.length).forEach((e,t)=>{var l;let r=a[t],o=new n.Z(null==U?void 0:null===(l=U[g+t])||void 0===l?void 0:l[1]).toString(10),s=new n.Z(o).div(1e18).toNumber();v[r.address.toLowerCase()].kink=s}),g=4*a.length,U.slice(g,g+a.length).forEach((e,t)=>{var l;let r=a[t],o=new n.Z(null==U?void 0:null===(l=U[g+t])||void 0===l?void 0:l[1]).toString(10),s=new n.Z(o).div(1e18).toNumber();v[r.address.toLowerCase()].multiplierPerTimestamp=s}),g=5*a.length,U.slice(g,g+a.length).forEach((e,t)=>{var l;let r=a[t],o=new n.Z(null==U?void 0:null===(l=U[g+t])||void 0===l?void 0:l[1]).toString(10),s=new n.Z(o).div(1e18).toNumber();v[r.address.toLowerCase()].retailSupplyApy=314496e4*s}),g=6*a.length,U.slice(g,g+a.length).forEach((e,t)=>{var l;let r=a[t],o=new n.Z(null==U?void 0:null===(l=U[g+t])||void 0===l?void 0:l[1]).toString(10),s=new n.Z(o).div(1e18).toNumber();v[r.address.toLowerCase()].creditSupplyApy=314496e4*s}),console.log("overviewRes: ",v),v}},92298:function(e,t,a){a.d(t,{OK:function(){return F},T4:function(){return C},al:function(){return E},Yp:function(){return k},N7:function(){return D},uQ:function(){return N},t$:function(){return M},Mx:function(){return I},c7:function(){return x},I7:function(){return q},Ts:function(){return W}});var l,r,o=a(5995),s=a(32730),n=a(98193),i=a(15469),d=a(92550),c=a(64626),u=a(37233),v=a(55615),m=a(29849),p=a(2956),w=a(12505),g=a(41639);let h={[w.VD.morph_alpha_testnet]:{source:"pyth",link:"https://hermes.pyth.network",idLength:"64",feeWei:"0"}},U=async(e,t,a)=>{var l,r,o,s,n;let i=(0,g.F5)(e);if((null===(l=h[e])||void 0===l?void 0:l.source)==="pyth"){let l=new u.O(h[e].link),r=t.map(t=>{var l,r;return(null===(l=a.find(e=>e.symbol===t))||void 0===l?void 0:l.oraclePriceFeedId)||(null===(r=a.find(e=>e.symbol===t))||void 0===r?void 0:r.pythFeedId)||h[e][t]}).filter(Boolean),s=r.map(e=>e.startsWith("0x")?e:"0x"+e);return{data:await l.getPriceFeedsUpdateData(s),feeWei:new c.Z(null===(o=h[e])||void 0===o?void 0:o.feeWei).times(r.length).toString(10),priceIds:s}}if((null===(r=h[e])||void 0===r?void 0:r.source)==="redstone"){let l=new m.r6(null==i?void 0:i.rpcUrl),r=new d.CH((null==i?void 0:null===(s=i.addresses)||void 0===s?void 0:s.aquaOracle)||"",w.rE,l),o=t.map(t=>{var l;return(null===(l=a.find(e=>e.symbol===t))||void 0===l?void 0:l.oraclePriceFeedId)||h[e][t]}).filter(Boolean),c=o.map(e=>(0,p.l)(e)),u=await new v.DataServiceWrapper({dataFeeds:c,uniqueSignersCount:3,dataServiceId:"redstone-primary-prod"}).getRedstonePayloadForManualUsage(r),g=o.map(e=>e.startsWith("0x")?e:"0x"+e);return{data:[u],feeWei:null===(n=h[e])||void 0===n?void 0:n.feeWei,priceIds:g}}return null},y=async(e,t,a)=>{var l,r;if((null===(l=h[e])||void 0===l?void 0:l.source)==="pyth"){let l=new u.O(h[e].link),r=t.filter(t=>{var l,r;return!!(null===(l=a.find(e=>e.symbol===t))||void 0===l?void 0:l.oraclePriceFeedId)||(null===(r=a.find(e=>e.symbol===t))||void 0===r?void 0:r.pythFeedId)||!!h[e][t]}),o=r.map(t=>{var l,r;return(null===(l=a.find(e=>e.symbol===t))||void 0===l?void 0:l.oraclePriceFeedId)||(null===(r=a.find(e=>e.symbol===t))||void 0===r?void 0:r.pythFeedId)||h[e][t]}).filter(Boolean).map(e=>e.startsWith("0x")?e:"0x"+e),s=await l.getLatestPriceFeeds(o);return{tokens:r,prices:(null==s?void 0:s.map(e=>{var t;return(null===(t=e.getPriceNoOlderThan(60))||void 0===t?void 0:t.getPriceAsNumberUnchecked())||0}))||[]}}if((null===(r=h[e])||void 0===r?void 0:r.source)==="redstone"){let l=t.filter(t=>{var l;return!!(null===(l=a.find(e=>e.symbol===t))||void 0===l?void 0:l.oraclePriceFeedId)||!!h[e][t]}).map(t=>{var l;return(null===(l=a.find(e=>e.symbol===t))||void 0===l?void 0:l.oraclePriceFeedId)||h[e][t]}).filter(Boolean).map(e=>(0,p.l)(e)),r=await new v.DataServiceWrapper({dataFeeds:l,uniqueSignersCount:1,dataServiceId:"redstone-primary-prod"}).getDataPackagesForPayload(),o=l.map(e=>{var t,a,l,o;let s=r.find(t=>{var a,l;return(null===(l=t.dataPackage)||void 0===l?void 0:null===(a=l.dataPoints)||void 0===a?void 0:a[0].dataFeedId)===e});return(null==s?void 0:null===(o=s.dataPackage)||void 0===o?void 0:null===(l=o.dataPoints)||void 0===l?void 0:null===(a=l[0])||void 0===a?void 0:null===(t=a.metadata)||void 0===t?void 0:t.value)||0});return{tokens:l,prices:o}}return null};(l=r||(r={})).AQUA_USER_STATS_OVERVIEW="AQUA_USER_STATS_OVERVIEW",l.AQUA_USER_AVAILABLE_TOKENS="AQUA_USER_AVAILABLE_TOKENS",l.AQUA_USER_AVAILABLE_TOKENS_SKELETON="AQUA_USER_AVAILABLE_TOKENS_SKELETON",l.AQUA_USER_SUPPLIES="AQUA_USER_SUPPLIES",l.AQUA_USER_BORROWS="AQUA_USER_BORROWS",l.AQUA_TOP_TOKENS="AQUA_TOP_TOKENS";var A=a(65093);let f=async(e,t,a,l,r)=>{a=(0,g.p$)(a);let o=(0,g.F5)(t),s=null==o?void 0:o.addresses.aquaVault,n=null==o?void 0:o.addresses.aquaOracle,d=await e.tryBlockAndAggregate.staticCall(!1,[...a.map(e=>({target:e.lpAddress,callData:new A.vU(w.Wo).encodeFunctionData("decimals",[])})),...a.map(e=>({target:e.address,callData:new A.vU(w.Wo).encodeFunctionData("balanceOf",[l])})),...a.map(e=>({target:e.lpAddress,callData:new A.vU(w.Wo).encodeFunctionData("balanceOf",[l])})),...a.map(e=>({target:e.lpAddress,callData:new A.vU(w.w8).encodeFunctionData("getAccountSnapshot",[l])})),...a.map(e=>({target:e.address,callData:new A.vU(w.Wo).encodeFunctionData("balanceOf",[s])})),...a.map(e=>({target:e.lpAddress,callData:new A.vU(w.w8).encodeFunctionData("supplyRatePerTimestamp",[])})),...a.map(e=>({target:e.lpAddress,callData:new A.vU(w.w8).encodeFunctionData("borrowRatePerTimestamp",[])})),...a.map(e=>({target:s,callData:new A.vU(w.G1).encodeFunctionData("markets",[e.lpAddress])})),...a.map(e=>({target:n,callData:new A.vU([{inputs:[{internalType:"contract CToken",name:"",type:"address"}],name:"priceIds",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"}]).encodeFunctionData("priceIds",[e.lpAddress])})),...a.map(e=>({target:n,callData:new A.vU(w.s2).encodeFunctionData("getUnderlyingPrice",[e.lpAddress])})),...a.map(e=>({target:s,callData:new A.vU(w.G1).encodeFunctionData("aquaCollateral",[r,e.lpAddress])})),...a.map(e=>({target:s,callData:new A.vU(w.G1).encodeFunctionData("checkMembership",[l,e.lpAddress])}))]),u=(0,g.p$)(d)[2],v=0;u.slice(v,v+a.length).forEach((e,t)=>{var l,r;let o=a[t],s=(null==u?void 0:null===(l=u[v+t])||void 0===l?void 0:l[0])?null==u?void 0:null===(r=u[v+t])||void 0===r?void 0:r[1]:i.N,n=new c.Z(s).toNumber();o.lpDecimals=n||18}),v=a.length,u.slice(v,v+a.length).forEach((e,t)=>{var l,r;let o=a[t],s=(null==u?void 0:null===(l=u[v+t])||void 0===l?void 0:l[0])?null==u?void 0:null===(r=u[v+t])||void 0===r?void 0:r[1]:i.N,n=new c.Z(s).toString(10),d=new c.Z(n).div(10**o.decimals);a[t].userBalance=d.toNumber()||0,a[t].userBalancePrecised=d.toString(10)||"0",a[t].userBalanceUsd=d.toNumber()*o.priceUsd||0}),v=2*a.length,u.slice(v,v+a.length).forEach((e,t)=>{var l,r;let o=a[t],s=(null==u?void 0:null===(l=u[v+t])||void 0===l?void 0:l[0])?null==u?void 0:null===(r=u[v+t])||void 0===r?void 0:r[1]:i.N,n=new c.Z(s).toString(10),d=new c.Z(n).div(10**o.lpDecimals);a[t].totalUserLpToken=d.toNumber()||0,a[t].totalUserLpTokenPrecised=d.toString(10)||"0",a[t].totalUserUnderlyingDepositPrecised=d.toString(10),a[t].totalUserUnderlyingDeposit=1*d.toNumber()||0,a[t].totalUserUnderlyingDepositUsd=a[t].totalUserUnderlyingDeposit*o.priceUsd||0}),v=3*a.length;let m=u.slice(v,v+a.length);for(let e=0;e<m.length;e++){let t=a[e],l=[];try{var p,U;let t=(null==u?void 0:null===(p=u[v+e])||void 0===p?void 0:p[0])?null==u?void 0:null===(U=u[v+e])||void 0===U?void 0:U[1]:i.N;l=new A.vU(w.w8).decodeFunctionResult("getAccountSnapshot",t)}catch(e){}let r=new c.Z(l[1]).toString(10),o=new c.Z(r).div(10**t.lpDecimals),s=new c.Z(l[2]).toString(10),n=new c.Z(s).div(10**t.lpDecimals),d=new c.Z(l[3]||1).div(1e18).toNumber();a[e].totalUserBorrowedPrecised=n.toString(10)||"0",a[e].totalUserBorrowed=n.toNumber()||0,a[e].totalUserBorrowedUsd=n.toNumber()*t.priceUsd||0,a[e].totalUserLpToken=a[e].totalUserLpToken||o.toNumber()||0,a[e].totalUserLpTokenPrecised=Number(a[e].totalUserLpToken)?a[e].totalUserLpTokenPrecised:o.toString(10),a[e].totalUserUnderlyingDeposit=Math.max(a[e].totalUserUnderlyingDeposit||0,o.toNumber()*d||0),a[e].totalUserUnderlyingDepositPrecised=new c.Z(r).times(l[3]).div(1e18).div(10**t.decimals).toString(10),a[e].totalUserUnderlyingDepositUsd=a[e].totalUserUnderlyingDeposit*t.priceUsd||0,a[e].exchangeRate=d}v=4*a.length,u.slice(v,v+a.length).forEach((e,t)=>{var l,r;let o=a[t],s=(null==u?void 0:null===(l=u[v+t])||void 0===l?void 0:l[0])?null==u?void 0:null===(r=u[v+t])||void 0===r?void 0:r[1]:i.N,n=new c.Z(s).decimalPlaces(0,1).toString(10),d=new c.Z(n).div(10**o.decimals);a[t].vaultBalance=d.toNumber()||0,a[t].vaultBalancePrecised=d.toString(10)||"0",a[t].vaultBalanceUsd=d.toNumber()*o.priceUsd||0}),v=5*a.length,u.slice(v,v+a.length).forEach((e,t)=>{var l,r;let o=a[t],s=(null==u?void 0:null===(l=u[v+t])||void 0===l?void 0:l[0])?null==u?void 0:null===(r=u[v+t])||void 0===r?void 0:r[1]:i.N,n=new c.Z(s).div(1e18).toNumber()||0;a[t].supplyRate=o.supplyRate||31536e5*n}),v=6*a.length,u.slice(v,v+a.length).forEach((e,t)=>{var l,r;let o=a[t],s=(null==u?void 0:null===(l=u[v+t])||void 0===l?void 0:l[0])?null==u?void 0:null===(r=u[v+t])||void 0===r?void 0:r[1]:i.N,n=new c.Z(s).div(1e18).toNumber()||0;a[t].borrowRate=o.borrowRate||31536e5*n}),v=7*a.length,u.slice(v,v+a.length).forEach((e,t)=>{var l,r;let o=(null==u?void 0:null===(l=u[v+t])||void 0===l?void 0:l[0])?null==u?void 0:null===(r=u[v+t])||void 0===r?void 0:r[1]:i.N,s=new A.vU(w.G1).decodeFunctionResult("markets",o),n=new c.Z(s[1]).div(1e18).times(100).toNumber();a[t].collateralFactor=n}),v=8*a.length,u.slice(v,v+a.length).forEach((e,l)=>{var r,o,s;let n=Number((null===(r=h[t])||void 0===r?void 0:r.idLength)||40),d=(null==u?void 0:null===(o=u[v+l])||void 0===o?void 0:o[0])?null==u?void 0:null===(s=u[v+l])||void 0===s?void 0:s[1]:i.N,c=d.startsWith("0x000")?d.slice(-n):d.slice(2,n+2);!c.startsWith("0x")&&c.length&&(c="0x"+c),0===parseInt(c)&&(c=""),a[l].oraclePriceFeedId=c}),v=9*a.length,u.slice(v,v+a.length).forEach((e,t)=>{var l,r;let o=(null==u?void 0:null===(l=u[v+t])||void 0===l?void 0:l[0])?null==u?void 0:null===(r=u[v+t])||void 0===r?void 0:r[1]:i.N,s=new c.Z(o).decimalPlaces(0,1).toString(10),n=new c.Z(s).div(10**(36-a[t].decimals)).toNumber();a[t].oraclePriceUsd=n||0}),v=10*a.length,u.slice(v,v+a.length).forEach((e,t)=>{var l,r;let o=a[t],s=(null==u?void 0:null===(l=u[v+t])||void 0===l?void 0:l[0])?null==u?void 0:null===(r=u[v+t])||void 0===r?void 0:r[1]:i.N,n=new c.Z(s).decimalPlaces(0,1).toString(10),d=new c.Z(n).div(10**(36-o.decimals));a[t].totalUserLpTokenLocked=d.toNumber()||0,a[t].totalUserLpTokenLockedPrecised=d.toString(10)||"0",a[t].totalUserLpTokenLockedUsd=d.toNumber()*o.exchangeRate*o.priceUsd||0,a[t].lpTokenPriceUsd=o.exchangeRate*o.priceUsd||0}),v=11*a.length,u.slice(v,v+a.length).forEach((e,t)=>{var l,r;let o=(null==u?void 0:null===(l=u[v+t])||void 0===l?void 0:l[0])?null==u?void 0:null===(r=u[v+t])||void 0===r?void 0:r[1]:i.N,s=!!new c.Z(o).toNumber();a[t].isEnteredMarket=s});let f=await y(t,a.map(e=>e.symbol),a);return(null==f?void 0:f.prices)&&a.forEach(e=>{let t=f.tokens.findIndex(t=>t===e.symbol);t>=0&&(e.oraclePriceUsd=(null==f?void 0:f.prices[t])||e.oraclePriceUsd||0,e.priceUsd=e.oraclePriceUsd||e.priceUsd||0,e.vaultBalanceUsd=e.vaultBalance*e.priceUsd,e.userBalanceUsd=e.userBalance*e.priceUsd,e.totalUserUnderlyingDepositUsd=e.totalUserUnderlyingDeposit*e.priceUsd,e.totalUserBorrowedUsd=e.totalUserBorrowed*e.priceUsd,e.totalUserLpTokenLockedUsd=e.totalUserLpTokenLocked*e.priceUsd,e.lpTokenPriceUsd=e.exchangeRate*e.priceUsd)}),console.log("tokens: ",a),a};var S=a(93908);let L=i.N.slice(0,-5)+"59310",b=e=>JSON.stringify(e.map(e=>({symbol:e.symbol,address:e.address,decimals:e.decimals,lpAddress:e.lpAddress,lpDecimals:e.lpDecimals,userBalance:e.userBalance,totalUserBorrowed:e.totalUserBorrowed,totalUserLpToken:e.totalUserLpToken,totalUserLpTokenLocked:e.totalUserLpTokenLocked,isEnteredMarket:e.isEnteredMarket,vaultBalance:e.vaultBalance}))),k=()=>{let{chain:e,blockchainMetadata:t}=(0,g.Os)(),a=!!(null==t?void 0:t.addresses.aquaVault)&&(null==t?void 0:t.addresses.aquaVault)!==i.N;return(0,o.a)({queryKey:[r.AQUA_USER_AVAILABLE_TOKENS_SKELETON,e],queryFn:async l=>{let{signal:r}=l;if(!a)return[];let o=t.defaultTokens.filter(e=>!(0,g.Mg)(e.address)&&e.compoundLpAddress!==i.N&&!!e.compoundLpAddress),s=await y(e,o.map(e=>e.symbol),o);return o.map(e=>({address:e.address,name:e.name||e.symbol,symbol:e.symbol,lpAddress:e.compoundLpAddress,decimals:e.decimals,lpDecimals:e.decimals,logoUrl:e.logoUrl,priceUsd:(null==s?void 0:s.prices[s.tokens.findIndex(t=>t===e.symbol)])||0,pythFeedId:e.pythFeedId}))},enabled:!!e,refetchOnWindowFocus:!1,staleTime:6e4})},D=()=>{let{data:e}=F();return(0,o.a)({queryKey:[r.AQUA_TOP_TOKENS,null==e?void 0:e.length],queryFn:async t=>{let{signal:a}=t,l="top-tokens",r=[];try{r=JSON.parse(localStorage.getItem(l)||"[]")}catch(e){}return!e&&(null==r?void 0:r.length)?r:(localStorage.setItem(l,JSON.stringify(e)),e||[])},enabled:!0,refetchOnWindowFocus:!1,staleTime:6e4,placeholderData:s.Wk})},F=()=>{let{data:e,isFetched:t}=k(),{provider:a,walletAddress:l,chain:n,blockchainMetadata:c}=(0,g.Os)(),u=!!(null==c?void 0:c.addresses.aquaVault)&&(null==c?void 0:c.addresses.aquaVault)!==i.N;return(0,o.a)({queryKey:[r.AQUA_USER_AVAILABLE_TOKENS,n,l,L],queryFn:async()=>{let t=(0,g.F5)(n),r=await (0,g.Vr)(a,n);if(!(null==e?void 0:e.length)||!t||!r||!u||!n)return[];let o=0;for(;o<3;){o+=1,r=await (0,g.Vr)(a,n);let s=new d.CH(t.addresses.multicall,w.ky,r),i=[],c={};try{[i,c]=await Promise.all([f(s,n,e,l||L,L||L),(0,S.n)(s,n,e)]),i.forEach(e=>{var t;e.marketOverview=c[null===(t=e.address)||void 0===t?void 0:t.toLowerCase()]})}catch(e){console.log("err get token or market info: ",e)}return i.sort((e,t)=>t.supplyRate-e.supplyRate),i}return[]},enabled:t,refetchOnWindowFocus:!1,staleTime:1e4,refetchInterval:15e3,placeholderData:s.Wk})},N=()=>{let{data:e}=F(),{walletAddress:t,chain:a}=(0,g.Os)();return(0,o.a)({queryKey:[r.AQUA_USER_STATS_OVERVIEW,t,a,b(e||[])],queryFn:async()=>{if(!(null==e?void 0:e.length))return{totalDepositedUsd:0,totalBorrowUsd:0,totalDepositedUsdWithCollateralFactor:0,netSupplyApy:0,netBorrowApy:0,healthFactor:0,totalVaultUsd:0};let t=e.reduce((e,t)=>e+t.vaultBalanceUsd,0),a=e.reduce((e,t)=>e+t.totalUserUnderlyingDepositUsd,0),l=e.reduce((e,t)=>e+t.totalUserUnderlyingDepositUsd*t.collateralFactor/100,0),r=e.reduce((e,t)=>e+t.totalUserBorrowedUsd,0),o=e.reduce((e,t)=>e+t.totalUserUnderlyingDepositUsd*t.supplyRate,0)/(a||1),s=e.reduce((e,t)=>e+t.totalUserBorrowedUsd*t.borrowRate,0)/(r||1);return{totalDepositedUsd:a,totalDepositedUsdWithCollateralFactor:l,totalBorrowUsd:r,netSupplyApy:o,netBorrowApy:s,healthFactor:r<=0?1/0:l/r,totalVaultUsd:t}},enabled:!!(null==e?void 0:e.length),refetchOnWindowFocus:!1,staleTime:6e4,placeholderData:s.Wk})},C=()=>{let{data:e}=F(),{walletAddress:t,chain:a}=(0,g.Os)();return(0,o.a)({queryKey:[r.AQUA_USER_BORROWS,a,t,b(e||[])],queryFn:async()=>(null==e?void 0:e.length)?{tokens:e.filter(e=>e.totalUserBorrowed>0)}:{tokens:[]},enabled:!!(null==e?void 0:e.length),refetchOnWindowFocus:!1,staleTime:6e4,placeholderData:s.Wk})},E=()=>{let{data:e}=F(),{walletAddress:t,chain:a}=(0,g.Os)();return(0,o.a)({queryKey:[r.AQUA_USER_SUPPLIES,a,t,b(e||[])],queryFn:async()=>(null==e?void 0:e.length)?{tokens:e.filter(e=>e.totalUserUnderlyingDeposit>0)}:{tokens:[]},enabled:!!(null==e?void 0:e.length),refetchOnWindowFocus:!1,staleTime:6e4,placeholderData:s.Wk})},P=()=>{let{provider:e,blockchainMetadata:t}=(0,g.Os)(),{refetch:a}=F();return(0,n.D)({mutationFn:async t=>{let l;if(!e)return{success:!1};let r=await e.getSigner(),o=new d.CH(t.token.lpAddress,w.w8,r),s=new c.Z(t.depositAmount).times(10**t.token.decimals).decimalPlaces(0,1).toString(10);try{l=await o.mint.estimateGas(s),l=new c.Z(l.toString()).times(1.2).decimalPlaces(0,1).toString(10)}catch(e){}try{let{maxPriorityFeePerGas:t,maxFeePerGas:a}=await e.getFeeData(),r=await o.mint(s,{gasLimit:l||void 0,maxPriorityFeePerGas:t,maxFeePerGas:a});await r.wait()}catch(e){return console.log("error deposit: ",e),{success:!1,error:e.toString()}}return setTimeout(()=>{a()},1500),a(),{success:!0}}})},B=()=>{let{provider:e,blockchainMetadata:t,chain:a}=(0,g.Os)(),{data:l,refetch:r}=F();return(0,n.D)({mutationFn:async o=>{let s;if(!e||!a||!l||!(null==t?void 0:t.addresses))return{success:!1};let n=await e.getSigner(),i=new d.CH(o.token.lpAddress,w.w8,n),u=l.filter(e=>e.totalUserBorrowed>0||e.totalUserLpToken>0).map(e=>e.symbol),v=l.filter(e=>e.totalUserBorrowed>0||e.totalUserLpToken>0).map(e=>e.address);try{s=await U(a,u,l)}catch(e){return console.log("oracle price error: ",e),{success:!1,error:"Failed getting oracle price"}}let m=new c.Z(o.withdrawAmount).times(10**o.token.lpDecimals).decimalPlaces(0,1).toString(10);if(s){let t;let a=[m,v,s.priceIds,s.data];try{t=await i.updatePricesAndRedeem.estimateGas(...a,{value:s.feeWei}),t=new c.Z(t.toString()).times(1.2).decimalPlaces(0,1).toString(10)}catch(e){}try{let{maxPriorityFeePerGas:l,maxFeePerGas:r}=await e.getFeeData(),o=await i.updatePricesAndRedeem(...a,{value:s.feeWei,gasLimit:t||void 0,maxFeePerGas:r,maxPriorityFeePerGas:l});await o.wait()}catch(e){return console.log("error withdraw: ",e),{success:!1,error:e.toString().includes("user rejected action")?"user rejected action":"Withdrawal failed"}}}else{let t;try{t=await i.redeem.estimateGas(m),t=new c.Z(t.toString()).times(1.2).decimalPlaces(0,1).toString(10)}catch(e){}try{let{maxPriorityFeePerGas:a,maxFeePerGas:l}=await e.getFeeData(),r=await i.redeem(m,{gasLimit:t||void 0,maxFeePerGas:l,maxPriorityFeePerGas:a});await r.wait()}catch(e){return console.log("error withdraw: ",e),{success:!1,error:e.toString().includes("user rejected action")?"user rejected action":"Withdrawal failed"}}}return setTimeout(()=>{r()},1500),r(),{success:!0}}})},R=()=>{let{provider:e,chain:t,blockchainMetadata:a}=(0,g.Os)(),{data:l,refetch:r}=F();return(0,n.D)({mutationFn:async a=>{let o;if(!e||!l||!t)return{success:!1};let s=await e.getSigner(),n=new d.CH(a.token.lpAddress,w.w8,s),i=l.filter(e=>e.totalUserBorrowed>0||e.totalUserLpToken>0).map(e=>e.symbol),u=l.filter(e=>e.totalUserBorrowed>0||e.totalUserLpToken>0).map(e=>e.address);try{o=await U(t,i,l)}catch(e){return{success:!1,error:"Failed getting oracle price"}}let v=new c.Z(a.borrowAmount).times(10**a.token.decimals).decimalPlaces(0,1).toString(10);if(o){let t;let a=[v,u,o.priceIds,o.data];try{t=await n.updatePricesAndBorrow.estimateGas(...a,{value:o.feeWei}),t=new c.Z(t.toString()).times(1.2).decimalPlaces(0,1).toString(10)}catch(e){}try{let{maxPriorityFeePerGas:l,maxFeePerGas:r}=await e.getFeeData(),s=await n.updatePricesAndBorrow(...a,{value:o.feeWei,gasLimit:t||void 0,maxPriorityFeePerGas:l,maxFeePerGas:r});await s.wait()}catch(e){return console.log("error borrow: ",e),{success:!1,error:e.toString()}}}else{let t;try{t=await n.borrow.estimateGas(v),t=new c.Z(t.toString()).times(1.2).decimalPlaces(0,1).toString(10)}catch(e){}try{let{maxPriorityFeePerGas:a,maxFeePerGas:l}=await e.getFeeData(),r=await n.borrow(v,{gasLimit:t||void 0,maxPriorityFeePerGas:a,maxFeePerGas:l});await r.wait()}catch(e){return console.log("error borrow: ",e),{success:!1,error:e.toString()}}}return setTimeout(()=>{r()},1500),r(),{success:!0}}})},T=()=>{let{provider:e,chain:t,blockchainMetadata:a}=(0,g.Os)(),{data:l,refetch:r}=F();return(0,n.D)({mutationFn:async a=>{let o;if(!e||!t||!l)return{success:!1};let s=await e.getSigner(),n=new d.CH(a.token.lpAddress,w.w8,s),i=new c.Z(a.repayAmount).times(10**a.token.decimals).decimalPlaces(0,1).toString(10);try{o=await n.repayBorrow.estimateGas(i),o=new c.Z(o.toString()).times(1.2).decimalPlaces(0,1).toString(10)}catch(e){}try{let{maxPriorityFeePerGas:t,maxFeePerGas:a}=await e.getFeeData(),l=await n.repayBorrow(i,{gasLimit:o||void 0,maxPriorityFeePerGas:t,maxFeePerGas:a});await l.wait()}catch(e){return console.log("error repay: ",e),{success:!1,error:e.toString()}}return r(),await (0,g._v)(1500),r(),{success:!0}}})},Z=()=>{let{provider:e,chain:t}=(0,g.Os)(),{data:a,refetch:l}=F();return(0,n.D)({mutationFn:async r=>{var o,s;let n;if(!e||!t||!a)return{success:!1};let i=await e.getSigner(),c=(null===(s=(0,g.F5)(t))||void 0===s?void 0:null===(o=s.addresses)||void 0===o?void 0:o.aquaVault)||"",u=new d.CH(c,w.G1,i),v=new d.CH(r.token.lpAddress,w.w8,i),m=a.filter(e=>e.totalUserBorrowed>0||e.totalUserLpToken>0).map(e=>e.symbol),p=a.filter(e=>e.totalUserBorrowed>0||e.totalUserLpToken>0).map(e=>e.address);try{n=await U(t,m,a)}catch(e){return console.log("error getting oracle: ",e),{success:!1,error:"Failed getting oracle price"}}if(n){let{maxPriorityFeePerGas:t,maxFeePerGas:a}=await e.getFeeData();try{let e;let l=await v.updatePrices(p,n.priceIds,n.data,{value:n.feeWei,maxPriorityFeePerGas:t,maxFeePerGas:a});await l.wait(),e=r.enable?await u.enterMarkets([r.token.lpAddress]):await u.exitMarket(r.token.lpAddress),await e.wait()}catch(e){return console.log("error enter or exit market: ",e),{success:!1,error:e.toString()}}}else try{let e;e=r.enable?await u.enterMarkets([r.token.lpAddress]):await u.exitMarket(r.token.lpAddress),await e.wait()}catch(e){return console.log("error enter or exit market: ",e),{success:!1,error:e.toString()}}return setTimeout(()=>{l()},1500),l(),{success:!0}}})};var O=a(7653),_=a(50461);function I(e,t){let[a,l]=(0,O.useState)(""),[r,o]=(0,O.useState)(!1),{walletAddress:s}=(0,g.Os)(),{chain:n,setChain:i}=(0,g.Os)(),{mutateAsync:d}=P(),{data:c}=F(),{data:u}=N(),{mutateAsync:v}=(0,g.vU)(),{onChangeEnterMarket:m,isLoading:p}=x(),w=null==c?void 0:c.find(t=>t.address.toLowerCase()===e.toLowerCase()),h=(0,g.F5)(n),{data:U,refetch:y}=(0,g.GQ)({params:{tokenAddress:e,ownerAdddress:s,spenderAddress:(null==w?void 0:w.lpAddress)||"",chain:n}}),A=(null==U?void 0:U.allowance)||0,f=async()=>{var r,s;if(!w)return;if(n!=n){o(!0);try{i((null===(r=(0,g.F5)(n))||void 0===r?void 0:r.chainIdNumber)||1)}catch(e){}return o(!1),!1}if(!A||A<Number(a)){o(!0);let t=_.Am.loading("Loading...");try{await v({tokenAddresses:[e],spender:w.lpAddress,amount:Number(a)}),y()}catch(e){}return _.Am.dismiss(t),o(!1),!1}o(!0);let c=_.Am.loading("Loading..."),u=await d({token:w,depositAmount:a});u.success?(l(""),_.Am.dismiss(c),(0,_.Am)("Deposit is successful",{type:"success",isLoading:!1,autoClose:3e3})):(_.Am.dismiss(c),(null===(s=u.error)||void 0===s?void 0:s.includes("user rejected action"))||(0,_.Am)("Deposit failed",{type:"error",isLoading:!1,autoClose:3e3})),o(!1),t&&t(u.success)},S=!1,L="Deposit ".concat(null==w?void 0:w.symbol);Number(a)?!(null==w?void 0:w.userBalance)||Number(a)>(null==w?void 0:w.userBalance)?(S=!0,L="Insufficient amount"):n!=n?L="Change network to ".concat(null==h?void 0:h.label):(!A||A<Number(a))&&(L="Give allowance"):(S=!0,L="Enter deposit amount");let b=(null==w?void 0:w.totalUserUnderlyingDeposit)||0,k=b+Number(a),D=((null==u?void 0:u.healthFactor)||0)+((null==u?void 0:u.totalBorrowUsd)?Number(a)*(((null==w?void 0:w.collateralFactor)||0)/100)*((null==w?void 0:w.priceUsd)||0)/(null==u?void 0:u.totalBorrowUsd):1/0),C=null==c?void 0:c.some(e=>e.collateralFactor>0);return{depositAmount:a,setDepositAmount:l,onDeposit:f,onReset:()=>{l(""),o(!1)},isDisabled:S,ctaText:L,isLoading:r,onChangeEnterMarket:m,isEnterMarketLoading:p,summary:{tokenDetails:w,currentDepositAmount:b,updatedDepositAmount:k,healthFactor:(null==u?void 0:u.healthFactor)||0,updatedHealthFactor:D,supplyApy:(null==w?void 0:w.supplyRate)||0,totalVaultBalanceUsd:(null==u?void 0:u.totalVaultUsd)||0,isBorrowAvailable:C}}}function W(e,t){let[a,l]=(0,O.useState)(""),[r,o]=(0,O.useState)(!1),{chain:s,setChain:n}=(0,g.Os)(),i=(0,g.F5)(s),{mutateAsync:d}=B(),{data:u}=F(),{data:v}=N(),m=null==u?void 0:u.find(t=>t.address.toLowerCase()===e.toLowerCase()),p=new c.Z(a||0).div(new c.Z((null==m?void 0:m.totalUserUnderlyingDepositPrecised)||"1")).times((null==m?void 0:m.totalUserLpTokenPrecised)||"0").toString(10),w=async()=>{var e,a;if(!m)return;if(s!=s){o(!0);try{n((null===(e=(0,g.F5)(s))||void 0===e?void 0:e.chainIdNumber)||1)}catch(e){}return o(!1),!1}o(!0);let r=_.Am.loading("Loading..."),i=await d({token:m,withdrawAmount:p});i.success?(l(""),_.Am.dismiss(r),(0,_.Am)("Withdrawal is successful",{type:"success",isLoading:!1,autoClose:3e3})):(_.Am.dismiss(r),(null===(a=i.error)||void 0===a?void 0:a.includes("user rejected action"))||(0,_.Am)(i.error,{type:"error",isLoading:!1,autoClose:3e3})),o(!1),t&&t(i.success)},h=(null==m?void 0:m.totalUserLpToken)||0,U=h-Number(p),y=(null==v?void 0:v.healthFactor)||1/0;v&&m&&(y=(null==v?void 0:v.totalBorrowUsd)?((null==v?void 0:v.totalDepositedUsdWithCollateralFactor)-Number(p)*(null==m?void 0:m.collateralFactor)/100*(null==m?void 0:m.priceUsd)*(null==m?void 0:m.exchangeRate))/((null==v?void 0:v.totalBorrowUsd)||1):1/0);let A=Math.min(((null==m?void 0:m.vaultBalance)||0)/((null==m?void 0:m.exchangeRate)||1),Number(h)),f=!1,S="Withdraw ".concat(null==m?void 0:m.symbol),L="";return Number(a)?!(null==m?void 0:m.totalUserLpToken)||Number(p)>(null==m?void 0:m.totalUserLpToken)?(f=!0,S="Insufficient amount"):s!=s?S="Change network to ".concat(null==i?void 0:i.label):y!==1/0&&y<=1?(f=!0,S="Health factor is not healthy"):(null==m?void 0:m.totalUserLpToken)&&Number(p)<=(null==m?void 0:m.totalUserLpToken)&&Number(a)>m.vaultBalance&&(f=!0,S="Not enough liquidity in the vault",L="VAULT_NOT_ENOUGH"):(f=!0,S="Enter Withdrawal amount"),{withdrawAmount:a,setWithdrawAmount:l,onWithdraw:w,onReset:()=>{l(""),o(!1)},isDisabled:f,ctaText:S,isLoading:r,summary:{tokenDetails:m,currentLpAmount:h,updatedLpAmount:U,healthFactor:(null==v?void 0:v.healthFactor)||0,updatedHealthFactor:y,supplyApy:(null==m?void 0:m.supplyRate)||0,maxLpTokenToWithdraw:A},bannerStatus:L}}function M(e,t){var a;let[l,r]=(0,O.useState)(""),[o,s]=(0,O.useState)(!1),{chain:n,setChain:i}=(0,g.Os)(),d=(0,g.F5)(n),{mutateAsync:u}=R(),{data:v}=F(),{data:m}=N(),p=null==v?void 0:v.find(t=>t.address.toLowerCase()===e.toLowerCase()),w=async()=>{var e,a;if(!p)return;if(n!=n){s(!0);try{i((null===(e=(0,g.F5)(n))||void 0===e?void 0:e.chainIdNumber)||1)}catch(e){}return s(!1),!1}s(!0);let o=_.Am.loading("Loading..."),d=await u({token:p,borrowAmount:l});d.success?(r(""),_.Am.dismiss(o),(0,_.Am)("Borrow is successful",{type:"success",isLoading:!1,autoClose:3e3})):(_.Am.dismiss(o),(null===(a=d.error)||void 0===a?void 0:a.includes("user rejected action"))||(0,_.Am)("Borrow failed",{type:"error",isLoading:!1,autoClose:3e3})),s(!1),t&&t(d.success)},h=(null==p?void 0:p.totalUserBorrowed)||0,U=h+Number(l),y=0===U?(null==m?void 0:m.healthFactor)||1/0:((null==m?void 0:m.totalDepositedUsdWithCollateralFactor)||0)/(((null==m?void 0:m.totalBorrowUsd)||0)+Number(l)*((null==p?void 0:p.priceUsd)||0)),A=Math.max(Math.min(Math.max(((null==m?void 0:m.totalDepositedUsdWithCollateralFactor)||0)-((null==m?void 0:m.totalBorrowUsd)||0),0),null!==(a=null==p?void 0:p.vaultBalanceUsd)&&void 0!==a?a:1/0)/((null==p?void 0:p.priceUsd)||1),0);A=new c.Z(A).decimalPlaces(10,1).toNumber();let f=!1,S="Borrow ".concat(null==p?void 0:p.symbol);return Number(l)?!(null==p?void 0:p.vaultBalance)||Number(l)>(null==p?void 0:p.vaultBalance)?(f=!0,S="Not enough fund to borrow"):n!=n?S="Change network to ".concat(null==d?void 0:d.label):y!==1/0&&y<1&&(f=!0,S="Your health factor is not healthy"):(f=!0,S="Enter borrow amount"),{borrowAmount:l,setBorrowAmount:r,onBorrow:w,onReset:()=>{r(""),s(!1)},isDisabled:f,ctaText:S,isLoading:o,summary:{tokenDetails:p,currentBorrow:h,updatedBorrowAmount:U,healthFactor:(null==m?void 0:m.healthFactor)||0,updatedHealthFactor:y,supplyApy:(null==p?void 0:p.supplyRate)||0,maxBorrow:A}}}function q(e,t){let[a,l]=(0,O.useState)(""),[r,o]=(0,O.useState)(!1),{chain:s,setChain:n,walletAddress:i}=(0,g.Os)(),d=(0,g.F5)(s),{mutateAsync:c}=T(),{data:u}=F(),{data:v}=N(),{mutateAsync:m}=(0,g.vU)(),p=null==u?void 0:u.find(t=>t.address.toLowerCase()===e.toLowerCase()),{data:w,refetch:h}=(0,g.GQ)({params:{tokenAddress:e,ownerAdddress:i,spenderAddress:(null==p?void 0:p.lpAddress)||"",chain:s}}),U=(null==w?void 0:w.allowance)||0,y=async()=>{var r,i;if(!p)return;if(s!=s){o(!0);try{n((null===(r=(0,g.F5)(s))||void 0===r?void 0:r.chainIdNumber)||1)}catch(e){}return o(!1),!1}if(!U||U<Number(a)){o(!0);let t=_.Am.loading("Loading...");try{await m({tokenAddresses:[e],spender:p.lpAddress,amount:Number(a)}),h()}catch(e){}return _.Am.dismiss(t),o(!1),!1}o(!0);let d=_.Am.loading("Loading..."),u=await c({token:p,repayAmount:a});u.success?(l(""),_.Am.dismiss(d),(0,_.Am)("Repayment is successful",{type:"success",isLoading:!1,autoClose:3e3})):(_.Am.dismiss(d),(null===(i=u.error)||void 0===i?void 0:i.includes("user rejected action"))||(0,_.Am)("Repayment failed",{type:"error",isLoading:!1,autoClose:3e3})),o(!1),t&&t(u.success)},A=(null==p?void 0:p.totalUserBorrowed)||0,f=A-Number(a),S=Math.max(((null==v?void 0:v.totalBorrowUsd)||0)-Number(a)*((null==p?void 0:p.priceUsd)||0),0),L=0===A?(null==v?void 0:v.healthFactor)||1/0:0===S?1/0:((null==v?void 0:v.totalDepositedUsdWithCollateralFactor)||0)/S,b=!1,k="Repay ".concat(null==p?void 0:p.symbol);return Number(a)?!(null==p?void 0:p.userBalance)||Number(a)>(null==p?void 0:p.userBalance)?(b=!0,k="Insufficient amount"):!(null==p?void 0:p.totalUserBorrowed)||Number(a)>(null==p?void 0:p.totalUserBorrowed)?(b=!0,k="You repay too much"):s!=s?k="Change network to ".concat(null==d?void 0:d.label):U<Number(a)&&(k="Give allowance"):(b=!0,k="Enter repay amount"),{repayAmount:a,setRepayAmount:l,onRepay:y,onReset:()=>{l(""),o(!1)},isDisabled:b,ctaText:k,isLoading:r,summary:{tokenDetails:p,currentBorrow:A,updatedBorrowAmount:f,healthFactor:(null==v?void 0:v.healthFactor)||0,updatedHealthFactor:L,supplyApy:(null==p?void 0:p.supplyRate)||0}}}function x(){let[e,t]=(0,O.useState)(!1),[a,l]=(0,O.useState)(""),{chain:r,setChain:o}=(0,g.Os)(),{mutateAsync:s}=Z(),{data:n}=F();return{isLoading:e,onChangeEnterMarket:async e=>{let a=null==n?void 0:n.find(t=>t.address.toLowerCase()===e.toLowerCase());if(!a)return;if(r!=r){t(!0);try{var i;o((null===(i=(0,g.F5)(r))||void 0===i?void 0:i.chainIdNumber)||1)}catch(e){}return t(!1),!1}if(!a.oraclePriceFeedId)return _.Am.error("Token is not available as collateral"),!1;t(!0);let d=_.Am.loading("Loading...");l(e),(await s({token:a,enable:!a.isEnteredMarket})).success?(_.Am.dismiss(d),(0,_.Am)(a.isEnteredMarket?"Success removing token as collateral":"Success adding token as collateral",{type:"success",isLoading:!1,autoClose:3e3})):(_.Am.dismiss(d),(0,_.Am)(a.isEnteredMarket?"Error removing token as collateral":"Error adding token as collateral",{type:"error",isLoading:!1,autoClose:3e3})),t(!1),l("")},activeTokenAddress:a}}}}]);