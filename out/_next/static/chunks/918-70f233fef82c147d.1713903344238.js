"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[918],{20918:function(e,t,a){a.d(t,{OK:function(){return N},al:function(){return P},uQ:function(){return E},Mx:function(){return O},c7:function(){return W},Ts:function(){return M}});var l,r,o=a(5995),s=a(32730),n=a(98193),i=a(15469),d=a(92550),c=a(64626),u=a(32859),v=a(37233),m=a(55615),p=a(29849),w=a(2956),g=a(95291),h=a(41639);let U={[g.VD.morph_alpha_testnet]:{source:"redstone",link:"",idLength:"64",feeWei:"0"}},y=async(e,t,a)=>{var l,r,o,s,n;let i=(0,h.F5)(e);if((null===(l=U[e])||void 0===l?void 0:l.source)==="pyth"){let l=new v.O(U[e].link),r=t.map(t=>{var l;return(null===(l=a.find(e=>e.symbol===t))||void 0===l?void 0:l.oraclePriceFeedId)||U[e][t]}).filter(Boolean),s=r.map(e=>e.startsWith("0x")?e:"0x"+e);return{data:await l.getPriceFeedsUpdateData(s),feeWei:new c.Z(null===(o=U[e])||void 0===o?void 0:o.feeWei).times(r.length).toString(10),priceIds:s}}if((null===(r=U[e])||void 0===r?void 0:r.source)==="redstone"){let l=new p.r6(null==i?void 0:i.rpcUrl),r=new d.CH((null==i?void 0:null===(s=i.addresses)||void 0===s?void 0:s.aquaOracle)||"",g.rE,l),o=t.map(t=>{var l;return(null===(l=a.find(e=>e.symbol===t))||void 0===l?void 0:l.oraclePriceFeedId)||U[e][t]}).filter(Boolean),c=o.map(e=>(0,w.l)(e)),u=await new m.DataServiceWrapper({dataFeeds:c,uniqueSignersCount:3,dataServiceId:"redstone-primary-prod"}).getRedstonePayloadForManualUsage(r),v=o.map(e=>e.startsWith("0x")?e:"0x"+e);return{data:[u],feeWei:null===(n=U[e])||void 0===n?void 0:n.feeWei,priceIds:v}}return null},A=async(e,t,a)=>{var l,r;if((null===(l=U[e])||void 0===l?void 0:l.source)==="pyth"){let l=new v.O(U[e].link),r=t.filter(t=>{var l;return!!(null===(l=a.find(e=>e.symbol===t))||void 0===l?void 0:l.oraclePriceFeedId)||!!U[e][t]}),o=r.map(t=>{var l;return(null===(l=a.find(e=>e.symbol===t))||void 0===l?void 0:l.oraclePriceFeedId)||U[e][t]}).filter(Boolean).map(e=>e.startsWith("0x")?e:"0x"+e),s=await l.getLatestPriceFeeds(o);return{tokens:r,prices:(null==s?void 0:s.map(e=>{var t;return(null===(t=e.getPriceNoOlderThan(60))||void 0===t?void 0:t.getPriceAsNumberUnchecked())||0}))||[]}}if((null===(r=U[e])||void 0===r?void 0:r.source)==="redstone"){let l=t.filter(t=>{var l;return!!(null===(l=a.find(e=>e.symbol===t))||void 0===l?void 0:l.oraclePriceFeedId)||!!U[e][t]}).map(t=>{var l;return(null===(l=a.find(e=>e.symbol===t))||void 0===l?void 0:l.oraclePriceFeedId)||U[e][t]}).filter(Boolean).map(e=>(0,w.l)(e)),r=await new m.DataServiceWrapper({dataFeeds:l,uniqueSignersCount:1,dataServiceId:"redstone-primary-prod"}).getDataPackagesForPayload(),o=l.map(e=>{var t,a,l,o;let s=r.find(t=>{var a,l;return(null===(l=t.dataPackage)||void 0===l?void 0:null===(a=l.dataPoints)||void 0===a?void 0:a[0].dataFeedId)===e});return(null==s?void 0:null===(o=s.dataPackage)||void 0===o?void 0:null===(l=o.dataPoints)||void 0===l?void 0:null===(a=l[0])||void 0===a?void 0:null===(t=a.metadata)||void 0===t?void 0:t.value)||0});return{tokens:l,prices:o}}return null};(l=r||(r={})).AQUA_USER_STATS_OVERVIEW="AQUA_USER_STATS_OVERVIEW",l.AQUA_USER_AVAILABLE_TOKENS="AQUA_USER_AVAILABLE_TOKENS",l.AQUA_USER_AVAILABLE_TOKENS_SKELETON="AQUA_USER_AVAILABLE_TOKENS_SKELETON",l.AQUA_USER_SUPPLIES="AQUA_USER_SUPPLIES",l.AQUA_USER_BORROWS="AQUA_USER_BORROWS";var L=a(65093);let S=async(e,t,a,l,r)=>{a=(0,h.p$)(a);let o=(0,h.F5)(t),s=null==o?void 0:o.addresses.aquaVault,n=null==o?void 0:o.addresses.aquaOracle,d=await e.tryBlockAndAggregate.staticCall(!1,[...a.map(e=>({target:e.lpAddress,callData:new L.vU(g.Wo).encodeFunctionData("decimals",[])})),...a.map(e=>({target:e.address,callData:new L.vU(g.Wo).encodeFunctionData("balanceOf",[l])})),...a.map(e=>({target:e.lpAddress,callData:new L.vU(g.Wo).encodeFunctionData("balanceOf",[l])})),...a.map(e=>({target:e.lpAddress,callData:new L.vU(g.w8).encodeFunctionData("getAccountSnapshot",[l])})),...a.map(e=>({target:e.address,callData:new L.vU(g.Wo).encodeFunctionData("balanceOf",[s])})),...a.map(e=>({target:e.lpAddress,callData:new L.vU(g.w8).encodeFunctionData("supplyRatePerTimestamp",[])})),...a.map(e=>({target:e.lpAddress,callData:new L.vU(g.w8).encodeFunctionData("borrowRatePerTimestamp",[])})),...a.map(e=>({target:s,callData:new L.vU(g.G1).encodeFunctionData("markets",[e.lpAddress])})),...a.map(e=>({target:n,callData:new L.vU([{inputs:[{internalType:"contract CToken",name:"",type:"address"}],name:"priceIds",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"}]).encodeFunctionData("priceIds",[e.lpAddress])})),...a.map(e=>({target:n,callData:new L.vU(g.s2).encodeFunctionData("getUnderlyingPrice",[e.lpAddress])})),...a.map(e=>({target:s,callData:new L.vU(g.G1).encodeFunctionData("aquaCollateral",[r,e.lpAddress])})),...a.map(e=>({target:s,callData:new L.vU(g.G1).encodeFunctionData("checkMembership",[l,e.lpAddress])}))]),u=(0,h.p$)(d)[2],v=0;u.slice(v,v+a.length).forEach((e,t)=>{var l,r;let o=a[t],s=(null==u?void 0:null===(l=u[v+t])||void 0===l?void 0:l[0])?null==u?void 0:null===(r=u[v+t])||void 0===r?void 0:r[1]:i.N,n=new c.Z(s).toNumber();o.lpDecimals=n||18}),v=a.length,u.slice(v,v+a.length).forEach((e,t)=>{var l,r;let o=a[t],s=(null==u?void 0:null===(l=u[v+t])||void 0===l?void 0:l[0])?null==u?void 0:null===(r=u[v+t])||void 0===r?void 0:r[1]:i.N,n=new c.Z(s).toString(10),d=new c.Z(n).div(10**o.decimals);a[t].userBalance=d.toNumber()||0,a[t].userBalancePrecised=d.toString(10)||"0",a[t].userBalanceUsd=d.toNumber()*o.priceUsd||0}),v=2*a.length,u.slice(v,v+a.length).forEach((e,t)=>{var l,r;let o=a[t],s=(null==u?void 0:null===(l=u[v+t])||void 0===l?void 0:l[0])?null==u?void 0:null===(r=u[v+t])||void 0===r?void 0:r[1]:i.N,n=new c.Z(s).toString(10),d=new c.Z(n).div(10**o.lpDecimals);a[t].totalUserLpToken=d.toNumber()||0,a[t].totalUserLpTokenPrecised=d.toString(10)||"0",a[t].totalUserUnderlyingDepositPrecised=d.toString(10),a[t].totalUserUnderlyingDeposit=1*d.toNumber()||0,a[t].totalUserUnderlyingDepositUsd=a[t].totalUserUnderlyingDeposit*o.priceUsd||0}),v=3*a.length;let m=u.slice(v,v+a.length);for(let e=0;e<m.length;e++){let t=a[e],l=[];try{var p,w;let t=(null==u?void 0:null===(p=u[v+e])||void 0===p?void 0:p[0])?null==u?void 0:null===(w=u[v+e])||void 0===w?void 0:w[1]:i.N;l=new L.vU(g.w8).decodeFunctionResult("getAccountSnapshot",t)}catch(e){}let r=new c.Z(l[1]).toString(10),o=new c.Z(r).div(10**t.lpDecimals),s=new c.Z(l[2]).toString(10),n=new c.Z(s).div(10**t.lpDecimals),d=new c.Z(l[3]||1).div(1e18).toNumber();a[e].totalUserBorrowedPrecised=n.toString(10)||"0",a[e].totalUserBorrowed=n.toNumber()||0,a[e].totalUserBorrowedUsd=n.toNumber()*t.priceUsd||0,a[e].totalUserLpToken=a[e].totalUserLpToken||o.toNumber()||0,a[e].totalUserLpTokenPrecised=Number(a[e].totalUserLpToken)?a[e].totalUserLpTokenPrecised:o.toString(10),a[e].totalUserUnderlyingDeposit=Math.max(a[e].totalUserUnderlyingDeposit||0,o.toNumber()*d||0),a[e].totalUserUnderlyingDepositPrecised=new c.Z(r).times(l[3]).div(1e18).div(10**t.decimals).toString(10),a[e].totalUserUnderlyingDepositUsd=a[e].totalUserUnderlyingDeposit*t.priceUsd||0,a[e].exchangeRate=d}v=4*a.length,u.slice(v,v+a.length).forEach((e,t)=>{var l,r;let o=a[t],s=(null==u?void 0:null===(l=u[v+t])||void 0===l?void 0:l[0])?null==u?void 0:null===(r=u[v+t])||void 0===r?void 0:r[1]:i.N,n=new c.Z(s).decimalPlaces(0,1).toString(10),d=new c.Z(n).div(10**o.decimals);a[t].vaultBalance=d.toNumber()||0,a[t].vaultBalancePrecised=d.toString(10)||"0",a[t].vaultBalanceUsd=d.toNumber()*o.priceUsd||0}),v=5*a.length,u.slice(v,v+a.length).forEach((e,t)=>{var l,r;let o=a[t],s=(null==u?void 0:null===(l=u[v+t])||void 0===l?void 0:l[0])?null==u?void 0:null===(r=u[v+t])||void 0===r?void 0:r[1]:i.N,n=new c.Z(s).div(1e18).toNumber()||0;a[t].supplyRate=o.supplyRate||31536e5*n}),v=6*a.length,u.slice(v,v+a.length).forEach((e,t)=>{var l,r;let o=a[t],s=(null==u?void 0:null===(l=u[v+t])||void 0===l?void 0:l[0])?null==u?void 0:null===(r=u[v+t])||void 0===r?void 0:r[1]:i.N,n=new c.Z(s).div(1e18).toNumber()||0;a[t].borrowRate=o.borrowRate||31536e5*n}),v=7*a.length,u.slice(v,v+a.length).forEach((e,t)=>{var l,r;let o=(null==u?void 0:null===(l=u[v+t])||void 0===l?void 0:l[0])?null==u?void 0:null===(r=u[v+t])||void 0===r?void 0:r[1]:i.N,s=new L.vU(g.G1).decodeFunctionResult("markets",o),n=new c.Z(s[1]).div(1e18).times(100).toNumber();a[t].collateralFactor=n}),v=8*a.length,u.slice(v,v+a.length).forEach((e,l)=>{var r,o,s;let n=Number((null===(r=U[t])||void 0===r?void 0:r.idLength)||40),d=(null==u?void 0:null===(o=u[v+l])||void 0===o?void 0:o[0])?null==u?void 0:null===(s=u[v+l])||void 0===s?void 0:s[1]:i.N,c=d.startsWith("0x000")?d.slice(-n):d.slice(2,n+2);!c.startsWith("0x")&&c.length&&(c="0x"+c),0===parseInt(c)&&(c=""),a[l].oraclePriceFeedId=c}),v=9*a.length,u.slice(v,v+a.length).forEach((e,t)=>{var l,r;let o=(null==u?void 0:null===(l=u[v+t])||void 0===l?void 0:l[0])?null==u?void 0:null===(r=u[v+t])||void 0===r?void 0:r[1]:i.N,s=new c.Z(o).decimalPlaces(0,1).toString(10),n=new c.Z(s).div(10**(36-a[t].decimals)).toNumber();a[t].oraclePriceUsd=n||0}),v=10*a.length,u.slice(v,v+a.length).forEach((e,t)=>{var l,r;let o=a[t],s=(null==u?void 0:null===(l=u[v+t])||void 0===l?void 0:l[0])?null==u?void 0:null===(r=u[v+t])||void 0===r?void 0:r[1]:i.N,n=new c.Z(s).decimalPlaces(0,1).toString(10),d=new c.Z(n).div(10**(36-o.decimals));a[t].totalUserLpTokenLocked=d.toNumber()||0,a[t].totalUserLpTokenLockedPrecised=d.toString(10)||"0",a[t].totalUserLpTokenLockedUsd=d.toNumber()*o.exchangeRate*o.priceUsd||0,a[t].lpTokenPriceUsd=o.exchangeRate*o.priceUsd||0}),v=11*a.length,u.slice(v,v+a.length).forEach((e,t)=>{var l,r;let o=(null==u?void 0:null===(l=u[v+t])||void 0===l?void 0:l[0])?null==u?void 0:null===(r=u[v+t])||void 0===r?void 0:r[1]:i.N,s=!!new c.Z(o).toNumber();a[t].isEnteredMarket=s});let y=await A(t,a.map(e=>e.symbol),a);return(null==y?void 0:y.prices)&&a.forEach(e=>{let t=y.tokens.findIndex(t=>t===e.symbol);t>=0&&(e.oraclePriceUsd=(null==y?void 0:y.prices[t])||e.oraclePriceUsd||0,e.priceUsd=e.oraclePriceUsd||e.priceUsd||0,e.vaultBalanceUsd=e.vaultBalance*e.priceUsd,e.userBalanceUsd=e.userBalance*e.priceUsd,e.totalUserUnderlyingDepositUsd=e.totalUserUnderlyingDeposit*e.priceUsd,e.totalUserBorrowedUsd=e.totalUserBorrowed*e.priceUsd,e.totalUserLpTokenLockedUsd=e.totalUserLpTokenLocked*e.priceUsd,e.lpTokenPriceUsd=e.exchangeRate*e.priceUsd)}),console.log("tokens: ",a),a};var f=a(9525),D=a(78900);let k=async(e,t,a)=>{var l,r;let o={},s=(null===(r=(0,h.F5)(t))||void 0===r?void 0:null===(l=r.addresses)||void 0===l?void 0:l.aquaVault)||i.N;a.forEach(e=>{o[e.address.toLowerCase()]={lpDecimals:e.lpDecimals,totalCash:0,totalRetailBorrow:0,totalMMBorrow:0,totalReserves:0,totalSupply:0,retailSupplyApy:0,creditSupplyApy:0,interestRateModelAddress:"",utilizationRate:0,priceUsd:e.priceUsd,baseRatePerTimestamp:0,jumpMultiplierPerTimestamp:0,kink:0,multiplierPerTimestamp:0,liquidationPenalty:0,reserveFactor:0}});let n=await e.tryBlockAndAggregate.staticCall(!1,[...a.map(e=>({target:e.lpAddress,callData:new L.vU(g.Wo).encodeFunctionData("decimals",[])})),...a.map(e=>({target:e.lpAddress,callData:new L.vU(g.w8).encodeFunctionData("getCash",[])})),...a.map(e=>({target:e.lpAddress,callData:new L.vU(g.w8).encodeFunctionData("totalBorrows",[])})),...a.map(e=>({target:e.lpAddress,callData:new L.vU(g.w8).encodeFunctionData("netSwapBorrow",[])})),...a.map(e=>({target:e.lpAddress,callData:new L.vU(g.w8).encodeFunctionData("totalReserves",[])})),...a.map(e=>({target:e.lpAddress,callData:new L.vU(g.w8).encodeFunctionData("interestRateModel",[])})),...a.map(e=>({target:s,callData:new L.vU(g.G1).encodeFunctionData("liquidationIncentiveMantissa",[])})),...a.map(e=>({target:e.lpAddress,callData:new L.vU(g.w8).encodeFunctionData("reserveFactorMantissa",[])})),...a.map(e=>({target:e.lpAddress,callData:new L.vU(g.Wo).encodeFunctionData("totalSupply",[])}))]),d=(0,h.p$)(n)[2],u=0;d.slice(u,u+a.length).forEach((e,t)=>{var l;let r=a[t],s=new c.Z(null==d?void 0:null===(l=d[u+t])||void 0===l?void 0:l[1]).toNumber();o[r.address.toLowerCase()].lpDecimals=s||18}),u=a.length,d.slice(u,u+a.length).forEach((e,t)=>{var l;let r=a[t],s=new c.Z(null==d?void 0:null===(l=d[u+t])||void 0===l?void 0:l[1]).toString(10),n=new c.Z(s).div(10**o[r.address.toLowerCase()].lpDecimals).toNumber();o[r.address.toLowerCase()].totalCash=n}),u=2*a.length,d.slice(u,u+a.length).forEach((e,t)=>{var l;let r=a[t],s=new c.Z(null==d?void 0:null===(l=d[u+t])||void 0===l?void 0:l[1]).toString(10),n=new c.Z(s).div(10**o[r.address.toLowerCase()].lpDecimals).toNumber();o[r.address.toLowerCase()].totalRetailBorrow=n}),u=3*a.length,d.slice(u,u+a.length).forEach((e,t)=>{var l;let r=a[t],s=new f.R,n=null==d?void 0:null===(l=d[u+t])||void 0===l?void 0:l[1],i="0";try{i=s.decode(["int"],n)[0]}catch(e){}let v=new c.Z(i).div(10**o[r.address.toLowerCase()].lpDecimals).toNumber();o[r.address.toLowerCase()].totalMMBorrow=v<0?0:v}),u=4*a.length,d.slice(u,u+a.length).forEach((e,t)=>{var l;let r=a[t],s=new c.Z(null==d?void 0:null===(l=d[u+t])||void 0===l?void 0:l[1]).toString(10),n=new c.Z(s).div(10**o[r.address.toLowerCase()].lpDecimals).toNumber();o[r.address.toLowerCase()].totalReserves=n}),u=5*a.length,d.slice(u,u+a.length).forEach((e,t)=>{var l,r;let s=a[t],n="0x"+(null==d?void 0:null===(r=d[u+t])||void 0===r?void 0:null===(l=r[1])||void 0===l?void 0:l.slice(-40));o[s.address.toLowerCase()].interestRateModelAddress=(0,D.UJ)(n)?n:i.N}),u=6*a.length,d.slice(u,u+a.length).forEach((e,t)=>{var l;let r=a[t],s=new c.Z(null==d?void 0:null===(l=d[u+t])||void 0===l?void 0:l[1]).toString(10)||"0",n=new c.Z(s).div(1e18).toNumber();o[r.address.toLowerCase()].liquidationPenalty=100*n}),u=7*a.length,d.slice(u,u+a.length).forEach((e,t)=>{var l;let r=a[t],s=new c.Z(null==d?void 0:null===(l=d[u+t])||void 0===l?void 0:l[1]).toString(10)||"0",n=new c.Z(s).div(1e18).toNumber();o[r.address.toLowerCase()].reserveFactor=100*n}),u=8*a.length,d.slice(u,u+a.length).forEach((e,t)=>{var l;let r=a[t],s=new c.Z(null==d?void 0:null===(l=d[u+t])||void 0===l?void 0:l[1]).toString(10)||"0",n=new c.Z(s).div(10**r.lpDecimals).toNumber();o[r.address.toLowerCase()].totalSupply=n});let v=await e.tryBlockAndAggregate.staticCall(!1,[...a.map(e=>({target:o[e.address.toLowerCase()].interestRateModelAddress,callData:new L.vU(g.kp).encodeFunctionData("utilizationRate",[new c.Z(o[e.address.toLowerCase()].totalCash||0).times(10**o[e.address.toLowerCase()].lpDecimals).decimalPlaces(0,1).toString(10),new c.Z(o[e.address.toLowerCase()].totalMMBorrow+o[e.address.toLowerCase()].totalRetailBorrow||0).times(10**o[e.address.toLowerCase()].lpDecimals).decimalPlaces(0,1).toString(10),new c.Z(o[e.address.toLowerCase()].totalReserves||0).times(10**o[e.address.toLowerCase()].lpDecimals).decimalPlaces(0,1).toString(10)])})),...a.map(e=>({target:o[e.address.toLowerCase()].interestRateModelAddress,callData:new L.vU(g.kp).encodeFunctionData("baseRatePerTimestamp",[])})),...a.map(e=>({target:o[e.address.toLowerCase()].interestRateModelAddress,callData:new L.vU(g.kp).encodeFunctionData("jumpMultiplierPerTimestamp",[])})),...a.map(e=>({target:o[e.address.toLowerCase()].interestRateModelAddress,callData:new L.vU(g.kp).encodeFunctionData("kink",[])})),...a.map(e=>({target:o[e.address.toLowerCase()].interestRateModelAddress,callData:new L.vU(g.kp).encodeFunctionData("multiplierPerTimestamp",[])})),...a.map(e=>({target:o[e.address.toLowerCase()].interestRateModelAddress,callData:new L.vU(g.kp).encodeFunctionData("getSupplyRate",[new c.Z(o[e.address.toLowerCase()].totalCash||0).times(10**o[e.address.toLowerCase()].lpDecimals).decimalPlaces(0,1).toString(10),new c.Z(o[e.address.toLowerCase()].totalRetailBorrow||0).times(10**o[e.address.toLowerCase()].lpDecimals).decimalPlaces(0,1).toString(10),new c.Z(o[e.address.toLowerCase()].totalReserves||0).times(10**o[e.address.toLowerCase()].lpDecimals).decimalPlaces(0,1).toString(10),new c.Z(o[e.address.toLowerCase()].reserveFactor||0).times(10**o[e.address.toLowerCase()].lpDecimals).decimalPlaces(0,1).toString(10)])})),...a.map(e=>({target:o[e.address.toLowerCase()].interestRateModelAddress,callData:new L.vU(g.kp).encodeFunctionData("getSupplyRate",[new c.Z(o[e.address.toLowerCase()].totalCash||0).times(10**o[e.address.toLowerCase()].lpDecimals).decimalPlaces(0,1).toString(10),new c.Z(o[e.address.toLowerCase()].totalMMBorrow||0).times(10**o[e.address.toLowerCase()].lpDecimals).decimalPlaces(0,1).toString(10),new c.Z(o[e.address.toLowerCase()].totalReserves||0).times(10**o[e.address.toLowerCase()].lpDecimals).decimalPlaces(0,1).toString(10),new c.Z(o[e.address.toLowerCase()].reserveFactor||0).times(10**o[e.address.toLowerCase()].lpDecimals).decimalPlaces(0,1).toString(10)])}))]),m=(0,h.p$)(v)[2];return u=0,m.slice(u,u+a.length).forEach((e,t)=>{var l;let r=a[t],s=new c.Z(null==m?void 0:null===(l=m[u+t])||void 0===l?void 0:l[1]).toString(10),n=new c.Z(s).div(1e18).toNumber();o[r.address.toLowerCase()].utilizationRate=Math.min(100*n,100)}),u=a.length,m.slice(u,u+a.length).forEach((e,t)=>{var l;let r=a[t],s=new c.Z(null==m?void 0:null===(l=m[u+t])||void 0===l?void 0:l[1]).toString(10),n=new c.Z(s).div(1e18).toNumber();o[r.address.toLowerCase()].baseRatePerTimestamp=n}),u=2*a.length,m.slice(u,u+a.length).forEach((e,t)=>{var l;let r=a[t],s=new c.Z(null==m?void 0:null===(l=m[u+t])||void 0===l?void 0:l[1]).toString(10),n=new c.Z(s).div(1e18).toNumber();o[r.address.toLowerCase()].jumpMultiplierPerTimestamp=n}),u=3*a.length,m.slice(u,u+a.length).forEach((e,t)=>{var l;let r=a[t],s=new c.Z(null==m?void 0:null===(l=m[u+t])||void 0===l?void 0:l[1]).toString(10),n=new c.Z(s).div(1e18).toNumber();o[r.address.toLowerCase()].kink=n}),u=4*a.length,m.slice(u,u+a.length).forEach((e,t)=>{var l;let r=a[t],s=new c.Z(null==m?void 0:null===(l=m[u+t])||void 0===l?void 0:l[1]).toString(10),n=new c.Z(s).div(1e18).toNumber();o[r.address.toLowerCase()].multiplierPerTimestamp=n}),u=5*a.length,m.slice(u,u+a.length).forEach((e,t)=>{var l;let r=a[t],s=new c.Z(null==m?void 0:null===(l=m[u+t])||void 0===l?void 0:l[1]).toString(10),n=new c.Z(s).div(1e18).toNumber();o[r.address.toLowerCase()].retailSupplyApy=314496e4*n}),u=6*a.length,m.slice(u,u+a.length).forEach((e,t)=>{var l;let r=a[t],s=new c.Z(null==m?void 0:null===(l=m[u+t])||void 0===l?void 0:l[1]).toString(10),n=new c.Z(s).div(1e18).toNumber();o[r.address.toLowerCase()].creditSupplyApy=314496e4*n}),console.log("overviewRes: ",o),o},b=i.N.slice(0,-5)+"59310",C=e=>JSON.stringify(e.map(e=>({symbol:e.symbol,address:e.address,decimals:e.decimals,lpAddress:e.lpAddress,lpDecimals:e.lpDecimals,userBalance:e.userBalance,totalUserBorrowed:e.totalUserBorrowed,totalUserLpToken:e.totalUserLpToken,totalUserLpTokenLocked:e.totalUserLpTokenLocked,isEnteredMarket:e.isEnteredMarket,vaultBalance:e.vaultBalance}))),F=()=>{let{chain:e,blockchainMetadata:t}=(0,h.Os)(),a=!!(null==t?void 0:t.addresses.aquaVault)&&(null==t?void 0:t.addresses.aquaVault)!==i.N;return(0,o.a)({queryKey:[r.AQUA_USER_AVAILABLE_TOKENS_SKELETON,e],queryFn:async e=>{let{signal:l}=e;return a?t.defaultTokens.filter(e=>!(0,h.Mg)(e.address)).map(e=>({address:e.address,name:e.name||e.symbol,symbol:e.symbol,lpAddress:e.compoundLpAddress,decimals:e.decimals,lpDecimals:e.decimals,logoUrl:e.logoUrl,priceUsd:0})):[]},enabled:!!e,refetchOnWindowFocus:!1,staleTime:6e4})},N=()=>{let{data:e,isFetched:t}=F(),{provider:a,walletAddress:l,chain:n,blockchainMetadata:c}=(0,h.Os)(),v=(0,u.useSearchParams)().get("address")||l,m=!!(null==c?void 0:c.addresses.aquaVault)&&(null==c?void 0:c.addresses.aquaVault)!==i.N;return(0,o.a)({queryKey:[r.AQUA_USER_AVAILABLE_TOKENS,n,l,v],queryFn:async()=>{let t=(0,h.F5)(n),r=await (0,h.Vr)(a,n);if(!(null==e?void 0:e.length)||!t||!r||!m||!n)return[];let o=0;for(;o<3;){o+=1,r=await (0,h.Vr)(a,n);let s=new d.CH(t.addresses.multicall,g.ky,r),i=[],c={};try{[i,c]=await Promise.all([S(s,n,e,l||b,v||b),k(s,n,e)]),i.forEach(e=>{var t;e.marketOverview=c[null===(t=e.address)||void 0===t?void 0:t.toLowerCase()]})}catch(e){console.log("err get token or market info: ",e)}return i.sort((e,t)=>t.supplyRate-e.supplyRate),i}return[]},enabled:t,refetchOnWindowFocus:!1,staleTime:1e4,refetchInterval:15e3,placeholderData:s.Wk})},E=()=>{let{data:e}=N(),{walletAddress:t,chain:a}=(0,h.Os)();return(0,o.a)({queryKey:[r.AQUA_USER_STATS_OVERVIEW,t,a,C(e||[])],queryFn:async()=>{if(!(null==e?void 0:e.length))return{totalDepositedUsd:0,totalBorrowUsd:0,totalDepositedUsdWithCollateralFactor:0,netSupplyApy:0,netBorrowApy:0,healthFactor:0,totalVaultUsd:0};let t=e.reduce((e,t)=>e+t.vaultBalanceUsd,0),a=e.reduce((e,t)=>e+t.totalUserUnderlyingDepositUsd,0),l=e.reduce((e,t)=>e+t.totalUserUnderlyingDepositUsd*t.collateralFactor/100,0),r=e.reduce((e,t)=>e+t.totalUserBorrowedUsd,0),o=e.reduce((e,t)=>e+t.totalUserUnderlyingDepositUsd*t.supplyRate,0)/(a||1),s=e.reduce((e,t)=>e+t.totalUserBorrowedUsd*t.borrowRate,0)/(r||1);return{totalDepositedUsd:a,totalDepositedUsdWithCollateralFactor:l,totalBorrowUsd:r,netSupplyApy:o,netBorrowApy:s,healthFactor:r<=0?1/0:l/r,totalVaultUsd:t}},enabled:!!(null==e?void 0:e.length),refetchOnWindowFocus:!1,staleTime:6e4,placeholderData:s.Wk})},P=()=>{let{data:e}=N(),{walletAddress:t,chain:a}=(0,h.Os)();return(0,o.a)({queryKey:[r.AQUA_USER_SUPPLIES,a,t,C(e||[])],queryFn:async()=>(null==e?void 0:e.length)?{tokens:e.filter(e=>e.totalUserUnderlyingDeposit>0)}:{tokens:[]},enabled:!!(null==e?void 0:e.length),refetchOnWindowFocus:!1,staleTime:6e4,placeholderData:s.Wk})},R=()=>{let{provider:e,blockchainMetadata:t}=(0,h.Os)(),{refetch:a}=N();return(0,n.D)({mutationFn:async t=>{let l;if(!e)return{success:!1};let r=await e.getSigner(),o=new d.CH(t.token.lpAddress,g.w8,r),s=new c.Z(t.depositAmount).times(10**t.token.decimals).decimalPlaces(0,1).toString(10);try{l=await o.mint.estimateGas(s),l=new c.Z(l.toString()).times(1.2).decimalPlaces(0,1).toString(10)}catch(e){}try{let e=await o.mint(s,{gasLimit:l||void 0});await e.wait()}catch(e){return console.log("error deposit: ",e),{success:!1,error:e.toString()}}return setTimeout(()=>{a()},1500),a(),{success:!0}}})},T=()=>{let{provider:e,blockchainMetadata:t,chain:a}=(0,h.Os)(),{data:l,refetch:r}=N();return(0,n.D)({mutationFn:async o=>{let s;if(!e||!a||!l||!(null==t?void 0:t.addresses))return{success:!1};let n=await e.getSigner(),i=new d.CH(o.token.lpAddress,g.w8,n),u=l.filter(e=>e.totalUserBorrowed>0||e.totalUserLpToken>0).map(e=>e.symbol),v=l.filter(e=>e.totalUserBorrowed>0||e.totalUserLpToken>0).map(e=>e.address);try{s=await y(a,u,l)}catch(e){return console.log("oracle price error: ",e),{success:!1,error:"Failed getting oracle price"}}let m=new c.Z(o.withdrawAmount).times(10**o.token.lpDecimals).decimalPlaces(0,1).toString(10);if(s){let e;let t=[m,v,s.priceIds,s.data];try{e=await i.updatePricesAndRedeem.estimateGas(...t,{value:s.feeWei}),e=new c.Z(e.toString()).times(1.2).decimalPlaces(0,1).toString(10)}catch(e){}try{let a=await i.updatePricesAndRedeem(...t,{value:s.feeWei,gasLimit:e||void 0});await a.wait()}catch(e){return console.log("error withdraw: ",e),{success:!1,error:e.toString().includes("user rejected action")?"user rejected action":"Withdrawal failed"}}}else{let e;try{e=await i.redeem.estimateGas(m),e=new c.Z(e.toString()).times(1.2).decimalPlaces(0,1).toString(10)}catch(e){}try{let t=await i.redeem(m,{gasLimit:e||void 0});await t.wait()}catch(e){return console.log("error withdraw: ",e),{success:!1,error:e.toString().includes("user rejected action")?"user rejected action":"Withdrawal failed"}}}return setTimeout(()=>{r()},1500),r(),{success:!0}}})},Z=()=>{let{provider:e,chain:t}=(0,h.Os)(),{data:a,refetch:l}=N();return(0,n.D)({mutationFn:async r=>{var o,s;let n;if(!e||!t||!a)return{success:!1};let i=await e.getSigner(),c=(null===(s=(0,h.F5)(t))||void 0===s?void 0:null===(o=s.addresses)||void 0===o?void 0:o.aquaVault)||"",u=new d.CH(c,g.G1,i),v=new d.CH(r.token.lpAddress,g.w8,i),m=a.filter(e=>e.totalUserBorrowed>0||e.totalUserLpToken>0).map(e=>e.symbol),p=a.filter(e=>e.totalUserBorrowed>0||e.totalUserLpToken>0).map(e=>e.address);try{n=await y(t,m,a)}catch(e){return console.log("error getting oracle: ",e),{success:!1,error:"Failed getting oracle price"}}if(n)try{let e;let t=await v.updatePrices(p,n.priceIds,n.data,{value:n.feeWei});await t.wait(),e=r.enable?await u.enterMarkets([r.token.lpAddress]):await u.exitMarket(r.token.lpAddress),await e.wait()}catch(e){return console.log("error enter or exit market: ",e),{success:!1,error:e.toString()}}else try{let e;e=r.enable?await u.enterMarkets([r.token.lpAddress]):await u.exitMarket(r.token.lpAddress),await e.wait()}catch(e){return console.log("error enter or exit market: ",e),{success:!1,error:e.toString()}}return setTimeout(()=>{l()},1500),l(),{success:!0}}})};var B=a(7653),_=a(50461);function O(e,t){let[a,l]=(0,B.useState)(""),[r,o]=(0,B.useState)(!1),{walletAddress:s}=(0,h.Os)(),{chain:n,setChain:i}=(0,h.Os)(),{mutateAsync:d}=R(),{data:c}=N(),{data:u}=E(),{mutateAsync:v}=(0,h.vU)(),{onChangeEnterMarket:m,isLoading:p}=W(),w=null==c?void 0:c.find(t=>t.address.toLowerCase()===e.toLowerCase()),g=(0,h.F5)(n),{data:U,refetch:y}=(0,h.GQ)({params:{tokenAddress:e,ownerAdddress:s,spenderAddress:(null==w?void 0:w.lpAddress)||"",chain:n}}),A=(null==U?void 0:U.allowance)||0,L=async()=>{var r,s;if(!w)return;if(n!=n){o(!0);try{i((null===(r=(0,h.F5)(n))||void 0===r?void 0:r.chainIdNumber)||1)}catch(e){}return o(!1),!1}if(!A||A<Number(a)){o(!0);let t=_.Am.loading("Loading...");try{await v({tokenAddresses:[e],spender:w.lpAddress,amount:Number(a)}),y()}catch(e){}return _.Am.dismiss(t),o(!1),!1}o(!0);let c=_.Am.loading("Loading..."),u=await d({token:w,depositAmount:a});u.success?(l(""),_.Am.dismiss(c),(0,_.Am)("Deposit is successful",{type:"success",isLoading:!1,autoClose:3e3})):(_.Am.dismiss(c),(null===(s=u.error)||void 0===s?void 0:s.includes("user rejected action"))||(0,_.Am)("Deposit failed",{type:"error",isLoading:!1,autoClose:3e3})),o(!1),t&&t(u.success)},S=!1,f="Deposit ".concat(null==w?void 0:w.symbol);Number(a)?!(null==w?void 0:w.userBalance)||Number(a)>(null==w?void 0:w.userBalance)?(S=!0,f="Insufficient amount"):n!=n?f="Change network to ".concat(null==g?void 0:g.label):(!A||A<Number(a))&&(f="Give allowance"):(S=!0,f="Enter deposit amount");let D=(null==w?void 0:w.totalUserUnderlyingDeposit)||0,k=D+Number(a),b=((null==u?void 0:u.healthFactor)||0)+((null==u?void 0:u.totalBorrowUsd)?Number(a)*(((null==w?void 0:w.collateralFactor)||0)/100)*((null==w?void 0:w.priceUsd)||0)/(null==u?void 0:u.totalBorrowUsd):1/0),C=null==c?void 0:c.some(e=>e.collateralFactor>0);return{depositAmount:a,setDepositAmount:l,onDeposit:L,onReset:()=>{l(""),o(!1)},isDisabled:S,ctaText:f,isLoading:r,onChangeEnterMarket:m,isEnterMarketLoading:p,summary:{tokenDetails:w,currentDepositAmount:D,updatedDepositAmount:k,healthFactor:(null==u?void 0:u.healthFactor)||0,updatedHealthFactor:b,supplyApy:(null==w?void 0:w.supplyRate)||0,totalVaultBalanceUsd:(null==u?void 0:u.totalVaultUsd)||0,isBorrowAvailable:C}}}function M(e,t){let[a,l]=(0,B.useState)(""),[r,o]=(0,B.useState)(!1),{chain:s,setChain:n}=(0,h.Os)(),i=(0,h.F5)(s),{mutateAsync:d}=T(),{data:u}=N(),{data:v}=E(),m=null==u?void 0:u.find(t=>t.address.toLowerCase()===e.toLowerCase()),p=new c.Z(a||0).div(new c.Z((null==m?void 0:m.totalUserUnderlyingDepositPrecised)||"1")).times((null==m?void 0:m.totalUserLpTokenPrecised)||"0").toString(10),w=async()=>{var e,a;if(!m)return;if(s!=s){o(!0);try{n((null===(e=(0,h.F5)(s))||void 0===e?void 0:e.chainIdNumber)||1)}catch(e){}return o(!1),!1}o(!0);let r=_.Am.loading("Loading..."),i=await d({token:m,withdrawAmount:p});i.success?(l(""),_.Am.dismiss(r),(0,_.Am)("Withdrawal is successful",{type:"success",isLoading:!1,autoClose:3e3})):(_.Am.dismiss(r),(null===(a=i.error)||void 0===a?void 0:a.includes("user rejected action"))||(0,_.Am)(i.error,{type:"error",isLoading:!1,autoClose:3e3})),o(!1),t&&t(i.success)},g=(null==m?void 0:m.totalUserLpToken)||0,U=g-Number(p),y=(null==v?void 0:v.healthFactor)||1/0;v&&m&&(y=(null==v?void 0:v.totalBorrowUsd)?((null==v?void 0:v.totalDepositedUsdWithCollateralFactor)-Number(p)*(null==m?void 0:m.collateralFactor)/100*(null==m?void 0:m.priceUsd)*(null==m?void 0:m.exchangeRate))/((null==v?void 0:v.totalBorrowUsd)||1):1/0);let A=Math.min(((null==m?void 0:m.vaultBalance)||0)/((null==m?void 0:m.exchangeRate)||1),Number(g)),L=!1,S="Withdraw ".concat(null==m?void 0:m.symbol),f="";return Number(a)?!(null==m?void 0:m.totalUserLpToken)||Number(p)>(null==m?void 0:m.totalUserLpToken)?(L=!0,S="Insufficient amount"):s!=s?S="Change network to ".concat(null==i?void 0:i.label):y!==1/0&&y<=1?(L=!0,S="Health factor is not healthy"):(null==m?void 0:m.totalUserLpToken)&&Number(p)<=(null==m?void 0:m.totalUserLpToken)&&Number(a)>m.vaultBalance&&(L=!0,S="Not enough liquidity in the vault",f="VAULT_NOT_ENOUGH"):(L=!0,S="Enter Withdrawal amount"),{withdrawAmount:a,setWithdrawAmount:l,onWithdraw:w,onReset:()=>{l(""),o(!1)},isDisabled:L,ctaText:S,isLoading:r,summary:{tokenDetails:m,currentLpAmount:g,updatedLpAmount:U,healthFactor:(null==v?void 0:v.healthFactor)||0,updatedHealthFactor:y,supplyApy:(null==m?void 0:m.supplyRate)||0,maxLpTokenToWithdraw:A},bannerStatus:f}}function W(){let[e,t]=(0,B.useState)(!1),[a,l]=(0,B.useState)(""),{chain:r,setChain:o}=(0,h.Os)(),{mutateAsync:s}=Z(),{data:n}=N();return{isLoading:e,onChangeEnterMarket:async e=>{let a=null==n?void 0:n.find(t=>t.address.toLowerCase()===e.toLowerCase());if(!a)return;if(r!=r){t(!0);try{var i;o((null===(i=(0,h.F5)(r))||void 0===i?void 0:i.chainIdNumber)||1)}catch(e){}return t(!1),!1}if(!a.oraclePriceFeedId)return _.Am.error("Token is not available as collateral"),!1;t(!0);let d=_.Am.loading("Loading...");l(e),(await s({token:a,enable:!a.isEnteredMarket})).success?(_.Am.dismiss(d),(0,_.Am)(a.isEnteredMarket?"Success removing token as collateral":"Success adding token as collateral",{type:"success",isLoading:!1,autoClose:3e3})):(_.Am.dismiss(d),(0,_.Am)(a.isEnteredMarket?"Error removing token as collateral":"Error adding token as collateral",{type:"error",isLoading:!1,autoClose:3e3})),t(!1),l("")},activeTokenAddress:a}}}}]);